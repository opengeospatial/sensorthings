[[ats_sta_websub_odata_blacklisting]]
[abstract_test]
====
[%metadata]
label:: /conf/discovery/api-sta-websub-odata
identifier:: /conf/discovery/api-sta-websub-odata-blacklisting
target:: /req/req-class-discovery/req-odata-blacklisting
subject:: /req/req-class/discovery
test-purpose:: Validate that the disallowed ODATA options do not return the HTTP link header `rel="self"`.

[.component,class=test method]
=====
[.component,class=step]
--
Construct multiple SensorThings URLs each including a supported ODATA option that is listed under the `odata_denied`.
--

[.component,class=step]
--
Issue HTTP HEAD and GET requests on each URL.
--

[.component,class=step]
--
Validate the contents of the returned HTTP header to not include the link header `rel="self"` but the link header `rel="help"`.
--

=====
====

==== Example root page with denied ODATA option `$expand`

[source,json]
----
{
    "serverSettings": {
        "conformance": {
            "http://www.opengis.net/spec/sensorthings-websub/1.0/conf/discovery"
        },
        "http://www.opengis.net/spec/sensorthings-websub/1.0/conf/discovery": {
            "topics_denied": [],
            "odata_denied": ["$expand"]
        }
    }
}
----

==== Example HTTP response for a URL including the denied ODATA option `$expand`

[source,text]
----
GET /sta/v1.1/Things?$expand=Locations HTTP/1.1
Host: sta-websub.secd.eu

HTTP/1.1 200 Ok
Content-type: application/json
Link: <http://hub.sta-websub.secd.eu>; rel="hub"
Link: <http://sta-websub.secd.eu/sta/v1.1/help#odata_option_denied>; rel="help"
[source,json]
----